---
title: "Webhooks"
description: "Receive real-time notifications for agent runs and triggers"
---

This document defines the standardized webhook payloads sent by the Mosaic platform. All webhook payloads are strictly typed using Pydantic models for consistency and reliability.

## Authentication

All webhooks are sent with a signature in the `X-Mosaic-Signature` header when you have a webhook secret configured. The signature is an HMAC-SHA256 hash of the payload using your webhook secret.

## Webhook Types

Mosaic sends four types of webhooks:

1. **RUN_STARTED** - Sent when an agent run begins processing
2. **RUN_FINISHED** - Sent when an agent run completes (successfully or with failures)  
3. **OUTPUTS_FINISHED** - Sent when individual nodes complete and produce outputs
4. **TEST** - Sent when testing your webhook endpoint

---

## RUN_STARTED

Sent immediately when an agent run begins processing. This webhook includes information about all input videos being processed.

### Payload Structure

```json
{
  "flag": "RUN_STARTED",
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "run_id": "6ba7b810-9dad-11d1-80b4-00c04fd430c8",
  "status": "running",
  "inputs": [
    {
      "video_id": "7ba7b810-9dad-11d1-80b4-00c04fd430c8",
      "agent_node_id": "8ba7b810-9dad-11d1-80b4-00c04fd430c8",
      "render_id": "9ba7b810-9dad-11d1-80b4-00c04fd430c8",
      "video_url": "https://storage.googleapis.com/signed-url-example",
      "thumbnail_url": "https://storage.googleapis.com/signed-url-thumbnail",
      "video_uri": "gs://bucket/path/to/video.mp4",
      "thumbnail_uri": "gs://bucket/path/to/thumbnail.jpg",
      "duration_ms": 30000,
      "width": 1920,
      "height": 1080,
      "file_size": 15728640
    }
  ],
  "triggered_by": {
    "type": "youtube",
    "channel_id": "UC123456789",
    "video_id": "dQw4w9WgXcQ",
    "video_title": "Amazing Video Title",
    "video_url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
    "triggered_at": "2024-01-15T10:30:00Z",
    "trigger_id": "aba7b810-9dad-11d1-80b4-00c04fd430c8"
  }
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| `flag` | `"RUN_STARTED"` | Webhook type identifier |
| `agent_id` | `string` | UUID of the agent being executed |
| `run_id` | `string` | UUID of the agent run (same as agent_state_id) |
| `status` | `"running"` | Current status of the run |
| `inputs` | `VideoInput[]` | Array of input videos being processed |
| `triggered_by` | `TriggerInfo` | Optional information about what triggered this run |

---

## RUN_FINISHED

Sent when an agent run completes processing (successfully or with failures). This webhook includes all final outputs produced by the run.

### Payload Structure

```json
{
  "flag": "RUN_FINISHED",
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "run_id": "6ba7b810-9dad-11d1-80b4-00c04fd430c8",
  "status": "completed",
  "inputs": [
    {
      "video_id": "7ba7b810-9dad-11d1-80b4-00c04fd430c8",
      "agent_node_id": "8ba7b810-9dad-11d1-80b4-00c04fd430c8",
      "render_id": "9ba7b810-9dad-11d1-80b4-00c04fd430c8",
      "video_url": "https://storage.googleapis.com/signed-url-example",
      "thumbnail_url": "https://storage.googleapis.com/signed-url-thumbnail",
      "duration_ms": 30000,
      "width": 1920,
      "height": 1080
    }
  ],
  "outputs": [
    {
      "video_url": "https://storage.googleapis.com/output-signed-url",
      "thumbnail_url": "https://storage.googleapis.com/output-thumbnail-url",
      "video_uri": "gs://bucket/path/to/output.mp4",
      "thumbnail_uri": "gs://bucket/path/to/output-thumb.jpg",
      "completed_at": "2024-01-15T10:35:00Z",
      "duration_ms": 30000,
      "file_size": 18874368,
      "agent_node_id": "cba7b810-9dad-11d1-80b4-00c04fd430c8"
    }
  ],
  "triggered_by": {
    "type": "youtube",
    "channel_id": "UC123456789",
    "video_id": "dQw4w9WgXcQ",
    "video_title": "Amazing Video Title",
    "video_url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
    "triggered_at": "2024-01-15T10:30:00Z",
    "trigger_id": "aba7b810-9dad-11d1-80b4-00c04fd430c8"
  }
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| `flag` | `"RUN_FINISHED"` | Webhook type identifier |
| `agent_id` | `string` | UUID of the agent that was executed |
| `run_id` | `string` | UUID of the agent run (same as agent_state_id) |
| `status` | `"completed"` | Final status of the run |
| `inputs` | `VideoInput[]` | Array of input videos that were processed |
| `outputs` | `VideoOutput[]` | Array of final output videos produced by the run |
| `triggered_by` | `TriggerInfo` | Optional information about what triggered this run |

---

## OUTPUTS_FINISHED

Sent whenever an individual node in the workflow finishes processing and generates output videos. Multiple `OUTPUTS_FINISHED` webhooks may be sent during a single run.

### Payload Structure

```json
{
  "flag": "OUTPUTS_FINISHED",
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "run_id": "6ba7b810-9dad-11d1-80b4-00c04fd430c8",
  "status": "running",
  "outputs": [
    {
      "video_url": "https://storage.googleapis.com/intermediate-output-url",
      "thumbnail_url": "https://storage.googleapis.com/intermediate-thumbnail-url",
      "video_uri": "gs://bucket/path/to/intermediate.mp4",
      "thumbnail_uri": "gs://bucket/path/to/intermediate-thumb.jpg",
      "completed_at": "2024-01-15T10:32:00Z",
      "duration_ms": 25000,
      "file_size": 12582912,
      "agent_node_id": "dba7b810-9dad-11d1-80b4-00c04fd430c8"
    }
  ],
  "triggered_by": {
    "type": "manual",
    "source": "api",
    "user_id": "eba7b810-9dad-11d1-80b4-00c04fd430c8",
    "triggered_at": "2024-01-15T10:30:00Z"
  }
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| `flag` | `"OUTPUTS_FINISHED"` | Webhook type identifier |
| `agent_id` | `string` | UUID of the agent being executed |
| `run_id` | `string` | UUID of the agent run (same as agent_state_id) |
| `status` | `"running"` | Current status of the overall run |
| `outputs` | `VideoOutput[]` | Array of output videos produced by this node |
| `triggered_by` | `TriggerInfo` | Optional information about what triggered this run |

---

## TEST

Sent when testing your webhook endpoint via the webhook testing API. This webhook helps you verify that your endpoint is working correctly.

### Payload Structure

```json
{
  "flag": "TEST",
  "run_id": "test",
  "timestamp": "2024-01-15T10:30:00Z",
  "message": "This is a test webhook from Mosaic",
  "user_id": "fba7b810-9dad-11d1-80b4-00c04fd430c8",
  "test_data": {
    "status": "test",
    "description": "If you received this, your webhook endpoint is working!"
  }
}
```

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| `flag` | `"TEST"` | Webhook type identifier |
| `run_id` | `"test"` | Always "test" for test webhooks |
| `timestamp` | `string` | ISO 8601 timestamp when test was sent |
| `message` | `string` | Human-readable test message |
| `user_id` | `string` | UUID of the user who initiated the test |
| `test_data` | `object` | Additional test data |

---

## Common Data Types

### VideoInput

Input video information included in webhook payloads.

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `video_id` | `string` | ✅ | UUID of the video file |
| `agent_node_id` | `string` | ✅ | UUID of the agent node processing this video |
| `render_id` | `string` | ✅ | UUID of the render record |
| `video_url` | `string` | ❌ | Signed URL to access the video file (expires after 1 hour) |
| `thumbnail_url` | `string` | ❌ | Signed URL to access the video thumbnail |
| `video_uri` | `string` | ❌ | Storage URI (GCS/S3) of the video |
| `thumbnail_uri` | `string` | ❌ | Storage URI (GCS/S3) of the thumbnail |
| `duration_ms` | `integer` | ❌ | Video duration in milliseconds |
| `width` | `integer` | ❌ | Video width in pixels |
| `height` | `integer` | ❌ | Video height in pixels |
| `file_size` | `integer` | ❌ | File size in bytes |

### VideoOutput

Output video information included in webhook payloads.

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `video_url` | `string` | ✅ | Signed URL to download the rendered video (expires after 1 hour) |
| `thumbnail_url` | `string` | ❌ | Signed URL to download the video thumbnail |
| `video_uri` | `string` | ❌ | Storage URI (GCS/S3) of the rendered video |
| `thumbnail_uri` | `string` | ❌ | Storage URI (GCS/S3) of the thumbnail |
| `completed_at` | `string` | ✅ | ISO 8601 timestamp when rendering completed |
| `duration_ms` | `integer` | ❌ | Rendered video duration in milliseconds |
| `file_size` | `integer` | ❌ | File size in bytes |
| `agent_node_id` | `string` | ❌ | UUID of the agent node that produced this output |

### TriggerInfo

Information about what triggered the agent run. The structure varies by trigger type.

#### YouTube Trigger

```json
{
  "type": "youtube",
  "channel_id": "UC123456789",
  "video_id": "dQw4w9WgXcQ",
  "video_title": "Amazing Video Title",
  "video_url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
  "triggered_at": "2024-01-15T10:30:00Z",
  "trigger_id": "aba7b810-9dad-11d1-80b4-00c04fd430c8"
}
```

#### Schedule Trigger

```json
{
  "type": "schedule",
  "scheduled_at": "2024-01-15T10:30:00Z",
  "schedule_id": "schedule-uuid",
  "cron_expression": "0 10 * * *"
}
```

#### Manual Trigger

```json
{
  "type": "manual",
  "source": "api",
  "user_id": "user-uuid",
  "triggered_at": "2024-01-15T10:30:00Z"
}
```

---

## Webhook Response

Your webhook endpoint should return a JSON response with HTTP status 200-299 to indicate successful receipt. The response format is optional, but we recommend:

```json
{
  "received": true,
  "message": "Webhook processed successfully",
  "processed_at": "2024-01-15T10:30:05Z"
}
```

---

## Error Handling

- Webhook delivery will be retried up to 3 times with exponential backoff if your endpoint returns a non-2xx status code
- Webhooks will timeout after 30 seconds
- Failed webhooks are logged and can be viewed in your dashboard

---

## Setting Up Webhooks

### For Agent Runs

Include the `callback_url` when starting an agent run:

```bash
curl -X POST "https://api.mosaic.so/agent/[agent_id]/run" \
  -H "Authorization: Bearer mk_your_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "video_ids": ["550e8400-e29b-41d4-a716-446655440000"],
    "callback_url": "https://your-app.com/webhooks/mosaic/abc123xyz"
  }'
```

### For Triggers

Configure webhooks when setting up triggers to be notified of automatic runs:

```bash
curl -X POST "https://api.mosaic.so/agent/[agent_id]/triggers/lowest_youtube_id/add_listeners" \
  -H "Authorization: Bearer mk_your_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "youtube_channels": ["UCxxxxxxxxxxxxxx"],
    "trigger_callback_url": "https://your-app.com/webhooks/triggers/def456uvw"
  }'
```

---

## TypeScript Types

For TypeScript users, here are the type definitions:

```typescript
type WebhookFlag = 'RUN_STARTED' | 'RUN_FINISHED' | 'OUTPUTS_FINISHED' | 'TEST';

interface VideoInput {
  video_id: string;
  agent_node_id: string;
  render_id: string;
  video_url?: string;
  thumbnail_url?: string;
  video_uri?: string;
  thumbnail_uri?: string;
  duration_ms?: number;
  width?: number;
  height?: number;
  file_size?: number;
}

interface VideoOutput {
  video_url: string;
  thumbnail_url?: string;
  video_uri?: string;
  thumbnail_uri?: string;
  completed_at: string;
  duration_ms?: number;
  file_size?: number;
  agent_node_id?: string;
}

interface YouTubeTriggerInfo {
  type: 'youtube';
  channel_id: string;
  video_id: string;
  video_title: string;
  video_url: string;
  triggered_at: string;
  trigger_id: string;
}

interface ScheduleTriggerInfo {
  type: 'schedule';
  scheduled_at: string;
  schedule_id: string;
  cron_expression?: string;
}

interface ManualTriggerInfo {
  type: 'manual';
  source: 'api' | 'ui';
  user_id: string;
  triggered_at: string;
}

type TriggerInfo = YouTubeTriggerInfo | ScheduleTriggerInfo | ManualTriggerInfo;

interface RunStartedWebhook {
  flag: 'RUN_STARTED';
  agent_id: string;
  run_id: string;
  status: 'running';
  inputs: VideoInput[];
  triggered_by?: TriggerInfo;
}

interface RunFinishedWebhook {
  flag: 'RUN_FINISHED';
  agent_id: string;
  run_id: string;
  status: 'completed';
  inputs: VideoInput[];
  outputs: VideoOutput[];
  triggered_by?: TriggerInfo;
}

interface OutputsFinishedWebhook {
  flag: 'OUTPUTS_FINISHED';
  agent_id: string;
  run_id: string;
  status: 'running';
  outputs: VideoOutput[];
  triggered_by?: TriggerInfo;
}

interface TestWebhook {
  flag: 'TEST';
  run_id: 'test';
  timestamp: string;
  message: string;
  user_id: string;
  test_data: {
    status: 'test';
    description: string;
  };
}

type WebhookPayload = RunStartedWebhook | RunFinishedWebhook | OutputsFinishedWebhook | TestWebhook;
```

---

## Next Steps

- Review [agent operations](/overview/agent-operations) for the complete workflow
- Set up [triggers](/overview/triggers) for automatic processing